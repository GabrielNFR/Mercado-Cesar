{% extends 'base.html' %}

{% block title %}Visualizar Pedidos{% endblock %}

{% block content %}
<div class="container" style="max-width: 1400px; margin: 40px auto; padding: 0 20px;">
    <h2 style="display: flex; align-items: center; justify-content: center; gap: 12px; color: #f4a361; font-size: 2rem; font-weight: 600; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #f4a361;">
        <svg xmlns="http://www.w3.org/2000/svg" style="width: 32px; height: 32px;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
        </svg>
        Gerenciar Pedidos
    </h2>
    
    <!-- Filtros -->
    <div style="background-color: #fff5f0; padding: 25px; border-radius: 12px; margin-bottom: 40px; border-left: 4px solid #f4a361; border-right: 4px solid #f4a361;">
        <h3 style="color: #374151; font-size: 1.125rem; font-weight: 600; margin-top: 0; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: 20px; color: #f4a361;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
            </svg>
            Filtrar Pedidos
        </h3>
        <form method="get" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Tipo de Entrega</label>
                <select name="tipo_entrega" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 0.95rem; background: white; color: #1f2937;">
                    <option value="">Todos os tipos</option>
                    <option value="DOMICILIO" {% if tipo_entrega_filtro == 'DOMICILIO' %}selected{% endif %}>🏠 Domicílio</option>
                    <option value="RETIRADA" {% if tipo_entrega_filtro == 'RETIRADA' %}selected{% endif %}>🏪 Retirada</option>
                </select>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Data Início</label>
                <input type="date" name="data_inicio" value="{{ data_inicio }}" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 0.95rem; background: white; color: #1f2937;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Data Fim</label>
                <input type="date" name="data_fim" value="{{ data_fim }}" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 0.95rem; background: white; color: #1f2937;">
            </div>
            
            <div>
                <button type="submit" style="width: 100%; padding: 12px; background-color: #f4a361; color: white; border: none; border-radius: 8px; font-size: 0.95rem; cursor: pointer; font-weight: 600; transition: background-color 0.2s;"
                        onmouseover="this.style.backgroundColor='#e28e46'"
                        onmouseout="this.style.backgroundColor='#f4a361'">
                    🔍 Filtrar
                </button>
            </div>
        </form>
    </div>
    
    <!-- Lista de pedidos -->
    <div>
        <h3 style="color: #374151; font-size: 1.125rem; font-weight: 600; margin-bottom: 25px; display: flex; align-items: center; gap: 8px;">
            <div style="width: 4px; height: 20px; background-color: #f4a361; border-radius: 2px;"></div>
            Pedidos Encontrados
            <span style="color: #9ca3af; font-size: 1rem; font-weight: 400; margin-left: 8px;">({{ pedidos.count }} no total)</span>
        </h3>
        
        {% if pedidos %}
        {% for pedido in pedidos %}
        <div style="background-color: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 30px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: all 0.3s;"
             onmouseover="this.style.borderColor='#f4a361'; this.style.boxShadow='0 4px 12px rgba(244, 163, 97, 0.15)'"
             onmouseout="this.style.borderColor='#e5e7eb'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
            <!-- Cabeçalho do pedido -->
            <div class="pedido-header-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; padding-bottom: 20px; border-bottom: 3px solid #f4a361; margin-bottom: 25px;">
                <div>
                    <h4 style="color: #f4a361; margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 700;">Pedido #{{ pedido.id }}</h4>
                    <p style="margin: 0; color: #6b7280; font-size: 0.9rem;">📅 {{ pedido.data_criacao|date:"d/m/Y H:i" }}</p>
                </div>
                
                <div>
                    <p style="margin: 0 0 6px 0; font-weight: 600; color: #6b7280; font-size: 0.85rem; text-transform: uppercase;">Cliente</p>
                    <p style="margin: 0; color: #1f2937; font-weight: 500; font-size: 0.95rem;">👤 {{ pedido.usuario.username }}</p>
                </div>
                
                <div>
                    <p style="margin: 0 0 6px 0; font-weight: 600; color: #6b7280; font-size: 0.85rem; text-transform: uppercase;">Tipo de Entrega</p>
                    <p style="margin: 0;">
                        {% if pedido.tipo_entrega == 'DOMICILIO' %}
                            <span style="display: inline-block; padding: 6px 14px; background-color: #dbeafe; color: #1e40af; border-radius: 8px; font-size: 0.85rem; font-weight: 600;">🏠 Domicílio</span>
                        {% else %}
                            <span style="display: inline-block; padding: 6px 14px; background-color: #d1fae5; color: #065f46; border-radius: 8px; font-size: 0.85rem; font-weight: 600;">🏪 Retirada</span>
                        {% endif %}
                    </p>
                </div>
                
                <div>
                    <p style="margin: 0 0 6px 0; font-weight: 600; color: #6b7280; font-size: 0.85rem; text-transform: uppercase;">Prazo</p>
                    <p style="margin: 0; color: #1f2937; font-weight: 500; font-size: 0.95rem;">⏱ {{ pedido.prazo_dias }} dia{{ pedido.prazo_dias|pluralize }} úteis</p>
                </div>
                
                <div>
                    <p style="margin: 0 0 6px 0; font-weight: 600; color: #6b7280; font-size: 0.85rem; text-transform: uppercase;">Total</p>
                    <p style="margin: 0; color: #10b981; font-size: 1.35rem; font-weight: 700;">R$ {{ pedido.calcular_total|floatformat:2 }}</p>
                </div>
            </div>
            
            <!-- Detalhes -->
            <div class="pedido-detalhes-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- Coluna 1: Endereço/Loja -->
                <div>
                    {% if pedido.tipo_entrega == 'DOMICILIO' %}
                        <h5 style="color: #374151; margin: 0 0 15px 0; font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                            📍 Endereço de Entrega
                        </h5>
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <p style="margin: 0; line-height: 1.7; color: #374151; font-size: 0.9rem;">
                                {{ pedido.endereco }}, {{ pedido.numero }}
                                {% if pedido.complemento %}<br>{{ pedido.complemento }}{% endif %}<br>
                                {{ pedido.bairro }}<br>
                                {{ pedido.cidade }}/{{ pedido.estado }}<br>
                                CEP: {{ pedido.cep }}
                            </p>
                            <p style="margin: 12px 0 0 0; padding-top: 10px; border-top: 1px solid #e5e7eb; color: #1f2937; font-weight: 600; font-size: 0.9rem;">
                                🚚 Frete: <span style="color: #3b82f6;">R$ {{ pedido.custo_entrega|floatformat:2 }}</span>
                            </p>
                        </div>
                    {% else %}
                        <h5 style="color: #374151; margin: 0 0 15px 0; font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                            🏪 Local de Retirada
                        </h5>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <p style="margin: 0; line-height: 1.7; color: #374151; font-size: 0.9rem;">
                                <strong style="color: #1f2937; font-size: 1rem;">{{ pedido.loja.nome }}</strong><br>
                                {{ pedido.loja.endereco }}, {{ pedido.loja.numero }}<br>
                                {{ pedido.loja.bairro }}<br>
                                {{ pedido.loja.cidade }}/{{ pedido.loja.estado }}<br>
                                CEP: {{ pedido.loja.cep }}
                            </p>
                            <p style="margin: 12px 0 0 0; padding-top: 10px; border-top: 1px solid #d1fae5; color: #065f46; font-weight: 600; font-size: 0.9rem;">
                                ✓ Frete Grátis
                            </p>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Coluna 2: Itens -->
                <div>
                    <h5 style="color: #374151; margin: 0 0 15px 0; font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                        📦 Itens do Pedido
                    </h5>
                    <div style="background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <table style="width: 100%; font-size: 0.85rem; border-collapse: collapse;">
                            <thead>
                                <tr style="background-color: #f4a361; color: white;">
                                    <th style="padding: 10px; text-align: left; font-weight: 600;">Produto</th>
                                    <th style="padding: 10px; text-align: center; font-weight: 600;">Qtd</th>
                                    <th style="padding: 10px; text-align: right; font-weight: 600;">Preço</th>
                                    <th style="padding: 10px; text-align: right; font-weight: 600;">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in pedido.itens.all %}
                                <tr style="border-bottom: 1px solid #f3f4f6;">
                                    <td style="padding: 10px; color: #1f2937; font-weight: 500;">{{ item.produto.nome }}</td>
                                    <td style="padding: 10px; text-align: center; color: #6b7280;">{{ item.quantidade }}</td>
                                    <td style="padding: 10px; text-align: right; color: #6b7280;">R$ {{ item.preco_unitario|floatformat:2 }}</td>
                                    <td style="padding: 10px; text-align: right; font-weight: 600; color: #f4a361;">R$ {{ item.calcular_subtotal|floatformat:2 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot>
                                <tr style="border-top: 2px solid #e5e7eb; background-color: #fafafa;">
                                    <td colspan="3" style="padding: 10px; text-align: right; font-weight: 600; color: #374151;">Subtotal Produtos:</td>
                                    <td style="padding: 10px; text-align: right; font-weight: 600; color: #1f2937;">R$ {{ pedido.calcular_subtotal_produtos|floatformat:2 }}</td>
                                </tr>
                                <tr style="background-color: #fafafa;">
                                    <td colspan="3" style="padding: 10px; text-align: right; color: #6b7280;">Frete:</td>
                                    <td style="padding: 10px; text-align: right; font-weight: 500;">
                                        {% if pedido.custo_entrega > 0 %}
                                            <span style="color: #1f2937;">R$ {{ pedido.custo_entrega|floatformat:2 }}</span>
                                        {% else %}
                                            <span style="color: #10b981; font-weight: 600;">Grátis</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr style="background-color: #fff5f0; border-top: 2px solid #f4a361;">
                                    <td colspan="3" style="padding: 12px; text-align: right; font-weight: 700; font-size: 1rem; color: #1f2937;">TOTAL:</td>
                                    <td style="padding: 12px; text-align: right; font-weight: 700; color: #10b981; font-size: 1.1rem;">R$ {{ pedido.calcular_total|floatformat:2 }}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div style="background: #f3f4f6; border: 2px dashed #9ca3af; border-radius: 12px; padding: 50px; text-align: center;">
            <div style="font-size: 3.5rem; margin-bottom: 15px;">📋</div>
            <p style="color: #374151; font-size: 1.25rem; font-weight: 600; margin-bottom: 10px;">Nenhum pedido encontrado</p>
            <p style="color: #6b7280; margin: 0; font-size: 0.95rem;">Tente ajustar os filtros ou aguarde novos pedidos.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
