{% extends 'base.html' %}

{% block title %}Gerenciar Lojas{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">
    <h2 style="color: #f0834e; margin-bottom: 30px; font-size: 2.25rem; font-weight: 600; padding-bottom: 20px; border-bottom: 3px solid #f0834e;">Gerenciar Lojas</h2>
    
    <!-- Mensagens de Sucesso/Erro -->
    {% if messages %}
        <div id="messages-container">
            {% for message in messages %}
                <div class="message-alert {% if message.tags %}{{ message.tags }}{% endif %}" 
                     style="padding: 16px 20px; margin-bottom: 16px; border-radius: 8px; display: flex; align-items: center; gap: 12px; font-weight: 500; box-shadow: 0 2px 8px rgba(0,0,0,0.1); animation: slideIn 0.3s ease-out; {% if 'success' in message.tags %}background-color: #d1fae5; color: #065f46; border-left: 4px solid #10b981;{% elif 'error' in message.tags %}background-color: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444;{% elif 'warning' in message.tags %}background-color: #fef3c7; color: #92400e; border-left: 4px solid #f59e0b;{% else %}background-color: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6;{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: 20px; flex-shrink: 0;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        {% if 'success' in message.tags %}
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        {% elif 'error' in message.tags %}
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        {% elif 'warning' in message.tags %}
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        {% else %}
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        {% endif %}
                    </svg>
                    <span style="flex: 1;">{{ message }}</span>
                    <button onclick="this.parentElement.remove()" style="background: none; border: none; cursor: pointer; padding: 4px; opacity: 0.6; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">
                        <svg xmlns="http://www.w3.org/2000/svg" style="width: 18px; height: 18px;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            {% endfor %}
        </div>
        
        <style>
            @keyframes slideIn {
                from {
                    transform: translateY(-20px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            
            @keyframes fadeOut {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(-20px);
                }
            }
            
            .message-alert.fading-out {
                animation: fadeOut 0.3s ease-out forwards;
            }
        </style>
        
        <script>
            // Auto-dismiss mensagens após 5 segundos
            document.addEventListener('DOMContentLoaded', function() {
                const messages = document.querySelectorAll('.message-alert');
                messages.forEach(function(message) {
                    setTimeout(function() {
                        message.classList.add('fading-out');
                        setTimeout(function() {
                            message.remove();
                        }, 300);
                    }, 5000);
                });
            });
        </script>
    {% endif %}
    
    <!-- Formulário para adicionar nova loja -->
    <div style="background-color: #f8f9fa; padding: 30px; border-radius: 8px; margin-bottom: 40px; border-left: 4px solid #f0834e; border-right: 4px solid #f0834e;">
        <h3 style="color: #374151; margin-top: 0; margin-bottom: 20px; font-size: 1.25rem; font-weight: 600;">
            <span style="color: #f0834e; font-size: 1.5rem; margin-right: 8px;">+</span>
            Cadastrar Nova Loja
        </h3>
        <form method="post" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            {% csrf_token %}
            
            <div style="grid-column: 1 / -1;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Nome da Loja *</label>
                <input type="text" name="nome" required style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Endereço *</label>
                <input type="text" name="endereco" required style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Número *</label>
                <input type="text" name="numero" required style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Bairro *</label>
                <input type="text" name="bairro" required style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Cidade *</label>
                <input type="text" name="cidade" required style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Estado *</label>
                <input type="text" name="estado" required maxlength="2" placeholder="PE" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px; text-transform: uppercase;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">CEP *</label>
                <input type="text" name="cep" required placeholder="50000-000" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Prazo de Retirada (dias) *</label>
                <input type="number" name="prazo_retirada_dias" required min="1" value="1" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div style="grid-column: 1 / -1; margin-top: 10px;">
                <button type="submit" style="padding: 14px 32px; background-color: #f0834e; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 600; transition: background-color 0.3s ease;">
                    Cadastrar Loja
                </button>
            </div>
        </form>
    </div>
    
    <!-- Lista de lojas existentes -->
    <div>
        <h3 style="color: #374151; margin-bottom: 20px; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
            <span style="width: 4px; height: 24px; background-color: #f0834e; display: inline-block;"></span>
            Lojas Cadastradas
        </h3>
        
        {% if lojas %}
        <table style="width: 100%; border-collapse: collapse; background-color: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <thead>
                <tr style="background-color: #007bff; color: white;">
                    <th style="padding: 15px; text-align: left; border-bottom: 2px solid #0056b3;">Nome</th>
                    <th style="padding: 15px; text-align: left; border-bottom: 2px solid #0056b3;">Endereço</th>
                    <th style="padding: 15px; text-align: left; border-bottom: 2px solid #0056b3;">Cidade</th>
                    <th style="padding: 15px; text-align: center; border-bottom: 2px solid #0056b3;">Prazo (dias)</th>
                    <th style="padding: 15px; text-align: center; border-bottom: 2px solid #0056b3;">Status</th>
                    <th style="padding: 15px; text-align: center; border-bottom: 2px solid #0056b3;">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for loja in lojas %}
                <tr style="border-bottom: 1px solid #ddd; {% if not loja.ativa %}background-color: #f8f9fa; opacity: 0.7;{% endif %}">
                    <td style="padding: 15px;">
                        <strong>{{ loja.nome }}</strong>
                    </td>
                    <td style="padding: 15px;">
                        {{ loja.endereco }}, {{ loja.numero }}<br>
                        <small style="color: #666;">{{ loja.bairro }} - CEP: {{ loja.cep }}</small>
                    </td>
                    <td style="padding: 15px;">{{ loja.cidade }}/{{ loja.estado }}</td>
                    <td style="padding: 15px; text-align: center;">{{ loja.prazo_retirada_dias }}</td>
                    <td style="padding: 15px; text-align: center;">
                        {% if loja.ativa %}
                            <span style="padding: 5px 15px; background-color: #28a745; color: white; border-radius: 12px; font-size: 12px; font-weight: bold;">ATIVA</span>
                        {% else %}
                            <span style="padding: 5px 15px; background-color: #dc3545; color: white; border-radius: 12px; font-size: 12px; font-weight: bold;">INATIVA</span>
                        {% endif %}
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <a href="{% url 'ativar_desativar_loja' loja.id %}" 
                           style="padding: 8px 16px; {% if loja.ativa %}background-color: #dc3545;{% else %}background-color: #28a745;{% endif %} color: white; text-decoration: none; border-radius: 4px; font-size: 14px; display: inline-block;">
                            {% if loja.ativa %}Desativar{% else %}Ativar{% endif %}
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="padding: 30px; text-align: center; background-color: #f8f9fa; border-radius: 4px; color: #666;">
            Nenhuma loja cadastrada ainda.
        </p>
        {% endif %}
    </div>
</div>
{% endblock %}
